<!DOCTYPE html>
<html>
	<head>
		<title>北京理工大学永胜学院信息管理系统</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="../static/layui-v2.5.6/layui/css/layui.css"  media="all">
		<style>
			#upVideoFile{
				display: inline-block;
				text-align: center;
				color: #fff;
				cursor: pointer;
				border-radius: 2px;
				height: 38px;
				background: #1e9fff;
				line-height: 38px;
				font-size: 14px;
				padding: 0 18px;
			}
			#upVideoFile:hover { 
				background: #2095ec; 
			}
			input[id=video] { 
				margin-left:-2000px;
				height:0; 
			}
		</style>
	</head>
	<body style="width:97%;margin:0 auto;">
		<div class="layui-tab">
			<ul class="layui-tab-title">
				<li class="layui-this" id="tab1" onclick="$('#tab2').text('视频添加');">视频列表</li>
				<li id="tab2" onclick="$('#resetBtn').click();$('#tab2').text('视频添加');$('#inputForm input[name=id]').val('');">视频添加</li>
			</ul>
			<div class="layui-tab-content">
				<div class="layui-tab-item layui-show">
					<div class="layui-form" id="searchForm">
						<div class="layui-form-item" style="margin-top: 20px;">
							<div class="layui-inline">
								<label class="layui-form-label">视频名称</label>
								<div class="layui-input-inline" style="width:220px;">
									<input type="text" name="name" lay-verify="title" autocomplete="off" placeholder="请输入视频名称" class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">视频类型</label>
								<div class="layui-input-inline">
									<select name="type" id="type" lay-search="">
										<option value=""></option>
										<optgroup label="计算机类">
											<option value="10001">C</option>
											<option value="10002">Java</option>
											<option value="10003">前端</option>
											<option value="10004">Python</option>
											<option value="10005">数据库</option>
										</optgroup>
										<optgroup label="理学类">
											<option value="10011">数学</option>
											<option value="10012">物理</option>
											<option value="10013">化学</option>
											<option value="10014">天文学</option>
											<option value="10015">地理科学</option>
										</optgroup>
										<optgroup label="语言类">
											<option value="10021">对外汉语</option>
											<option value="10022">六级雅思</option>
											<option value="10023">考研英语</option>
											<option value="10024">听力口语</option>
											<option value="10025">写作翻译</option>
										</optgroup>
									</select>
								</div>
							</div>
							<div class="layui-inline">
								<button type="button" class="layui-btn layui-btn-normal" onclick="search(0)">查询</button>
								<button type="button" class="layui-btn layui-btn-primary" onclick="search(1)">重置</button>
							</div>
						</div>
						<table class="layui-table" id="contentTable">
							<thead>
								<tr>
									<th>序号</th>
									<th>视频名称</th>
									<th width="250">视频简介</th>
									<th>视频类型</th>
									<th>视频封面</th>
									<th>视频资源</th>
									<th>上传人</th>
									<th>上传时间</th>
									<th>操作</th>
								</tr> 
							</thead>
							<tbody>
								<tr class="line_1">
									<td>1</td>
									<td>C语言入门</td>
									<td>本C语言教程从以下几个模块来贯穿主要知识点：初始C程序、数据类型、运算符、语句结构、函数和数组。每个阶段都配有练习题。</td>
									<td>
										<input type="hidden" value="10001"/><label>C</label>
									</td>
									<td>
										<input type="hidden" value="../static/images/sc_c.jpg"/>
										<a class="galpop-single" href="../static/images/sc_c.jpg" title="点击可查看大图">
											<img src="../static/images/sc_c.jpg" class="img-thumbnail" style="max-width:120px;width:120px;height:70px;"/>
										</a>
									</td>
									<td>
										<input type="hidden" value="../static/videos/C语言程序设计.mp4"/>
										<video style="width:150px;height:90px;" src="../static/videos/C语言程序设计.mp4" controls="controls"></video>
									</td>
									<td>测试用户</td>
									<td>2020-05-22</td>
									<td style="display:none;">无</td>
									<td>
										<button type="button" class="layui-btn layui-btn-primary layui-btn-sm" title="编辑" onclick="update(1)"><i class="layui-icon"></i></button>
										<button type="button" class="layui-btn layui-btn-danger layui-btn-sm" title="删除" onclick="deleteLine(1)"><i class="layui-icon"></i></button>
									</td>
								</tr>
								<tr class="line_2">
									<td>2</td>
									<td>Java程序设计</td>
									<td>本课程是在已有的基础上让学习者能够以Java语言编写具有一定规模、综合性的应用程序。本课程主要有三部分：一是Java语言， 二是Java类库及应用，三是如何写出出高质量的代码。
									</td>
									<td>
										<input type="hidden" value="10002"/><label>Java</label>
									</td>
									<td>
										<input type="hidden" value="../static/images/sc_java.png"/>
										<a class="galpop-single" href="../static/images/sc_java.png" title="点击可查看大图">
											<img src="../static/images/sc_java.png" class="img-thumbnail" style="max-width:120px;width:120px;height:70px;"/>
										</a>
									</td>
									<td>
										<input type="hidden" value="../static/videos/Java程序设计.mp4"/>
										<video style="width:150px;height:90px;" src="../static/videos/Java程序设计.mp4" controls="controls"></video>
									</td>
									<td>测试用户</td>
									<td>2020-05-22</td>
									<td style="display:none;">无</td>
									<td>
										<button type="button" class="layui-btn layui-btn-primary layui-btn-sm" title="编辑" onclick="update(2)"><i class="layui-icon"></i></button>
										<button type="button" class="layui-btn layui-btn-danger layui-btn-sm" title="删除" onclick="deleteLine(2)"><i class="layui-icon"></i></button>
									</td>
								</tr>
								<tr class="line_3">
									<td>3</td>
									<td>Python程序设计</td>
									<td>课程将帮助大家快速、轻松且系统的学习Python语言，高效编写程序。本课程主要讲解“Python基础语法”全体系，包括3个教学部分：第一部分初识Python语言，第二部分深入Python语言，第三部分运用Python语言。</td>
									<td>
										<input type="hidden" value="10004"/><label>Python</label>
									</td>
									<td>
										<input type="hidden" value="../static/images/sc_python.jpg"/>
										<a class="galpop-single" href="../static/images/sc_python.jpg" title="点击可查看大图">
											<img src="../static/images/sc_python.jpg" class="img-thumbnail" style="max-width:120px;width:120px;height:70px;"/>
										</a>
									</td>
									<td>
										<input type="hidden" value="../static/videos/Python程序设计.mp4"/>
										<video style="width:150px;height:90px;" src="../static/videos/Python程序设计.mp4" controls="controls"></video>
									</td>
									<td>测试用户</td>
									<td>2020-05-22</td>
									<td style="display:none;">无</td>
									<td>
										<button type="button" class="layui-btn layui-btn-primary layui-btn-sm" title="编辑" onclick="update(2)"><i class="layui-icon"></i></button>
										<button type="button" class="layui-btn layui-btn-danger layui-btn-sm" title="删除" onclick="deleteLine(2)"><i class="layui-icon"></i></button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div id="page"></div>
				</div>
				<!-- 视频添加 -->
				<div class="layui-tab-item">
					<div style="width:30%;margin-top:20px;">  
						<form class="layui-form" id="inputForm" lay-filter="example" action="">
						  <input type="hidden" name="id" value=""/>
						  <div class="layui-form-item">
							<label class="layui-form-label"><span style="color:red;">* </span>视频名称</label>
							<div class="layui-input-block">
							  <input type="text" name="name" required  lay-verify="required" placeholder="请输入名称" autocomplete="off" class="layui-input">
							</div>
						  </div>
						  <div class="layui-form-item">
							<label class="layui-form-label"><span style="color:red;">* </span>视频简介</label>
							<div class="layui-input-block">
							  <textarea name="intro" placeholder="请输入简介" lay-verify="required" class="layui-textarea"></textarea>
							</div>
						  </div>
						  <div class="layui-form-item">
							<label class="layui-form-label"><span style="color:red;">* </span>视频分类</label>
							<div class="layui-input-block">
								<select name="type" id="type" lay-verify="required" lay-search="">
									<option value=""></option>
									<optgroup label="计算机类">
										<option value="10001">C</option>
										<option value="10002">Java</option>
										<option value="10003">前端</option>
										<option value="10004">Python</option>
										<option value="10005">数据库</option>
									</optgroup>
									<optgroup label="理学类">
										<option value="10011">数学</option>
										<option value="10012">物理</option>
										<option value="10013">化学</option>
										<option value="10014">天文学</option>
										<option value="10015">地理科学</option>
									</optgroup>
									<optgroup label="语言类">
										<option value="10021">对外汉语</option>
										<option value="10022">六级雅思</option>
										<option value="10023">考研英语</option>
										<option value="10024">听力口语</option>
										<option value="10025">写作翻译</option>
									</optgroup>
								</select>
							</div>
						  </div>
						  <div class="layui-form-item">
							<div class="layui-inline">
							  <label class="layui-form-label"><span style="color:red;">* </span>视频封面</label>
							  <div class="layui-input-inline" style="width:100px;">
								<div class="layui-upload">
								  <button type="button" class="layui-btn layui-btn-normal" id="uploadBtn">上传图片</button>
								  <div class="layui-upload-list">
									<img class="layui-upload-img" id="uploadImg" style="width:92px;height:92px;display:none;">
									<input type="hidden" id="imgpath" name="imgpath" value=""/>
									<p id="uploadText"></p>
								  </div>
								</div>   
							  </div>
							  <div class="layui-form-mid layui-word-aux">图片格式</div>
							</div>
						  </div>
						  <div class="layui-form-item">
							<div class="layui-inline">
							  <label class="layui-form-label"><span style="color:red;">* </span>视频资源</label>
							  <div class="layui-input-inline" style="width:100px;">
								<video style="width:400px;height:200px;display:none;" src="" id="video0" controls="controls"></video><!--style="height:auto;"-->
								<a href="javascript:;" class="a-upload">
									<label for="video" id="upVideoFile">上传视频</label>
									<input class="form-control" type="file" style="height:auto;" id="video" name="video"/>
									<input type="hidden" id="videopath" name="videopath" value=""/>
								</a>
							  </div>
							  <div class="layui-form-mid layui-word-aux" id="video_swf">视频格式</div>
							</div>
						  </div>
						  <div class="layui-form-item layui-form-text">
							<label class="layui-form-label">备注</label>
							<div class="layui-input-block">
							  <textarea name="remark" placeholder="请输入内容" class="layui-textarea"></textarea>
							</div>
						  </div>
						  <div class="layui-form-item">
							<div class="layui-input-block">
							  <button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">保存</button>
							  <button type="reset" class="layui-btn layui-btn-primary" id="resetBtn">重置</button>
							  <button type="button" class="layui-btn layui-btn-primary" onclick="$('#resetBtn,#tab1').click();">返回</button>
							</div>
						  </div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<link type="text/css" rel="stylesheet" href="../static/jquery-galpop/css/jquery.galpop.css" media="screen" />
		<script type="text/javascript" src="../static/jquery/jquery-3.2.1.min.js"></script>
		<script src="../static/layui-v2.5.6/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../static/jquery-galpop/jquery.galpop.min.js"></script>
		<script>
		
			$(document).ready(function() {
				$('.galpop-single').galpop();
				$("#resetBtn").click(function(){
					$("#inputForm #uploadImg").hide();
					$("#inputForm #uploadImg").attr("src","");
					$("#inputForm #imgpath").val("");
					$("#inputForm #video0").hide();
					$("#inputForm #video0").attr("src","");
					$("#inputForm #videopath").val("");
					$("#video_swf").show();
				})
				// 视频上传
				$("#video").change(function(e){
					/*var objUrl = getObjectURL(this.files[0]) ;
					if (objUrl) {
						$("#video0").show() ;
						$("#video0").attr("src", objUrl) ;
					}*/
					var file = e.target.files[0];
					if(window.FileReader) {
						 var fr = new FileReader();
						 fr.readAsDataURL(file);
						 fr.onloadend = function(e) {
							 base64Data = e.target.result;
							 $("#video_swf").hide();
							 $("#video0").show() ;
							 $("#video0").attr("src", base64Data);
							 $("#videopath").val(base64Data);
						 }
					}
				})
			});
			function getObjectURL(file) {
				var url = null ;
				if (window.createObjectURL!=undefined) { // basic
					url = window.createObjectURL(file) ;
				} else if (window.URL!=undefined) { // mozilla(firefox)
					url = window.URL.createObjectURL(file) ;
				} else if (window.webkitURL!=undefined) { // webkit or chrome
					url = window.webkitURL.createObjectURL(file) ;
				}
				return url ;
			}
			layui.use(['form','element'], function(){
				var $ = layui.jquery
				,element = layui.element;
			});
			layui.use(['laypage', 'layer'], function(){
				var laypage = layui.laypage
				,layer = layui.layer;
				// 总页数低于页码总数
				laypage.render({
					elem: 'page'
					,theme: '#1E9FFF'
					,count: 10 // 数据总数
				});
			});
			layui.use('upload', function(){
			  var $ = layui.jquery
			  ,upload = layui.upload;
			  //普通图片上传
			  var uploadInst = upload.render({
				elem: '#uploadBtn'
				,url: 'https://httpbin.org/post' //改成您自己的上传接口
				,before: function(obj){
				  //预读本地文件示例，不支持ie8
				  obj.preview(function(index, file, result){
					$('#uploadImg').show();
					$('#uploadImg').attr('src', result); //图片链接（base64）
					$('#imgpath').val(result);
				  });
				},done: function(res){
				  //如果上传失败
				  if(res.code > 0){
					return layer.msg('上传失败');
				  }
				},error: function(){
				  //演示失败状态，并实现重传
				  var demoText = $('#uploadText');
				  demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
				  demoText.find('.demo-reload').on('click', function(){
					uploadInst.upload();
				  });
				}
			  });
			 })
			layui.use(['form','element'], function(){
				var form = layui.form;
				// 监听提交
				form.on('submit(formDemo)', function(data){
					// layer.msg(JSON.stringify(data.field));
					var imgpath = $("#inputForm input[name='imgpath']").val();
					var videopath = $("#inputForm input[name='videopath']").val();
					if (imgpath == "") {
						layer.msg('请上传视频封面！', {icon:0});
						layer.tips('<b>请上传视频封面！</b>', '#uploadBtn', {tips: [1, '#ea5200']});
						return false;
					}
					if (videopath == "") {
						layer.msg('请上传视频资源！', {icon:0});
						layer.tips('<b>请上传视频资源！</b>', '#upVideoFile', {tips: [1, '#ea5200']});
						return false;
					} else {
						if (videopath.indexOf('video') == -1) {
							layer.msg('请上传视频格式文件！', {icon:0});
							layer.tips('<b>请上传视频格式文件！</b>', '#upVideoFile', {tips: [1, '#ea5200']});
							return false;
						}
					}
					var id = $("#inputForm input[name='id']").val();
					var name = $("#inputForm input[name='name']").val();
					var intro = $("#inputForm textarea[name='intro']").val();
					var typeval = $("#inputForm #type option:selected").val();
					var typetext = $("#inputForm #type option:selected").text();
					var remark = $("#inputForm textarea[name='remark']").val();
					var massage = "";
					if (id != "") {
						// 修改
						$(".line_" + id).children('td').eq(1).text(name);
						$(".line_" + id).children('td').eq(2).text(intro);
						$(".line_" + id).children('td').eq(3).find("input").val(typeval);
						$(".line_" + id).children('td').eq(3).find("label").text(typetext);
						$(".line_" + id).children('td').eq(4).find("input").val(imgpath);
						$(".line_" + id).children('td').eq(4).find("a").attr("href",imgpath);
						$(".line_" + id).children('td').eq(4).find("img").attr("src",imgpath);
						$(".line_" + id).children('td').eq(5).find("input").val(videopath);
						$(".line_" + id).children('td').eq(5).find("video").attr("src",videopath);
						$(".line_" + id).children('td').eq(8).text(remark);
						massage = "修改成功！";
					} else {
						// 新增
						var dataCount = 0;
						$('#contentTable tbody').find('tr').each(function(){
							var id = parseInt($(this).children('td').eq(0).text().trim());
							if (id > dataCount)
								dataCount = id;
						})
						dataCount = dataCount + 1;
						var html = "<tr class='line_"+dataCount+"'>";
						html += "<td>"+dataCount+"</td>";
						html += "<td>"+name+"</td>";
						html += "<td>"+intro+"</td>";
						html += "<td><input type='hidden' value='"+typeval+"'/><label>"+typetext+"</label></td>";
						html += "<td><input type='hidden' value='"+imgpath+"'/>";
						html += "<a class='galpop-single' href='"+imgpath+"' title='点击可查看大图'>";
						html += "<img src='"+imgpath+"' class='img-thumbnail' style='max-width:120px;width:120px;height:70px;'/>";
						html += "</a></td>";
						html += "<td><input type='hidden' value='"+videopath+"'/>";
						html += "<video style='width:150px;height:90px;' src='"+videopath+"' controls='controls'></video></td>";
						html += "<td>测试用户</td>";
						html += "<td>"+getNowFormatDate()+"</td>";
						html += "<td style='display:none;'>"+remark+"</td>";
						html += "<td>";
						html += "<button type='button' class='layui-btn layui-btn-primary layui-btn-sm' title='编辑' onclick='update("+dataCount+")'><i class='layui-icon'></i></button>";
						html += "<button type='button' class='layui-btn layui-btn-danger layui-btn-sm' title='删除' onclick='deleteLine("+dataCount+")'><i class='layui-icon'></i></button>";
						html += "</td>";
						html += "</tr>";
						$("#contentTable tbody").append(html);
						massage = "添加成功！";
						$('.galpop-single').galpop();
					}
					$("#resetBtn,#tab1").click();
					layer.msg(massage,{icon:1});
					return false;
				});
			});
			 // 查询 
			 function search(type){
				if (type == 0) {
					$("#contentTable tbody tr").css("display","");
					var nameInput = $("#searchForm input[name='name']").val().trim();
					var typeSelect = $("#searchForm #type option:selected").text().trim();
					for (var i = 0; i < $("#contentTable tbody tr").length; i++) {
						var name = $("#contentTable tbody tr").eq(i).children('td').eq(1).text().trim();
						var type = $("#contentTable tbody tr").eq(i).children('td').eq(3).text().trim();
						if (name.indexOf(nameInput) == -1 || type.indexOf(typeSelect) == -1) {
							$("#contentTable tbody tr").eq(i).css("display","none");
						}
					}
				 } else {
					 $("#contentTable tbody tr").css("display","");
					 $("#searchForm input[name='name']").val("");
					 $('#searchForm #type').siblings("div.layui-form-select").find('dl').find('dd[lay-value=""]').click();
				 }
			}
			// 删除
			function deleteLine(linenum) {
				layer.confirm('您确认要删除该条数据吗？', {
				  btn: ['确认','取消'], title : '系统提示', icon: 3
				}, function(index){
					$(".line_" + linenum).remove();
					layer.close(index);
					layer.msg('删除成功！',{icon:1});
				})
			}
			// 修改
			function update(index) {
				$("#tab2").click();
				$("#tab2").text("视频修改");
				$("#video_swf").hide();
				// 取值
				var id = $(".line_" + index).children('td').eq(0).text().trim();
				var name = $(".line_" + index).children('td').eq(1).text().trim();
				var intro = $(".line_" + index).children('td').eq(2).text().trim();
				var type = $(".line_" + index).children('td').eq(3).find("input").val();
				var imgpath = $(".line_" + index).children('td').eq(4).find("input").val();
				var videopath = $(".line_" + index).children('td').eq(5).find("input").val();
				var remark = $(".line_" + index).children('td').eq(8).text().trim();
				// 赋值
				$("#inputForm input[name='id']").val(id);
				$("#inputForm input[name='name']").val(name);
				$("#inputForm textarea[name='intro']").val(intro);
				$('#inputForm #type').siblings("div.layui-form-select").find('dl').find('dd[lay-value="'+type+'"]').click();
				$("#inputForm #uploadImg").show();
				$("#inputForm #uploadImg").attr("src",imgpath);
				$("#inputForm #imgpath").val(imgpath);
				$("#inputForm #video0").show();
				$("#inputForm #video0").attr("src",videopath);
				$("#inputForm #videopath").val(videopath);
				$("#inputForm textarea[name='remark']").val(remark);
			}
			
			 // 获取当前日期
			 function getNowFormatDate() {
				var date = new Date();
				var seperator1 = "-";
				var year = date.getFullYear();
				var month = date.getMonth() + 1;
				var strDate = date.getDate();
				if (month >= 1 && month <= 9) {
					month = "0" + month;
				}
				if (strDate >= 0 && strDate <= 9) {
					strDate = "0" + strDate;
				}
				var currentdate = year + seperator1 + month + seperator1 + strDate;
				return currentdate;
			}
		</script>
	</body>
</html>