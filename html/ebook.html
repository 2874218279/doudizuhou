<!DOCTYPE html>
<html>
	<head>
		<title>北京理工大学永胜学院信息管理系统</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="../static/layui-v2.5.6/layui/css/layui.css"  media="all">
		<style>
			#upEBookFile{
				display: inline-block;
				text-align: center;
				color: #fff;
				cursor: pointer;
				border-radius: 2px;
				height: 38px;
				background: #1e9fff;
				line-height: 38px;
				font-size: 14px;
				padding: 0 18px;
			}
			#upEBookFile:hover { 
				background: #2095ec; 
			}
			input[id=ebook] { 
				margin-left:-2000px;
				height:0; 
			}
		</style>
		<script type="text/javascript" src="../static/jquery/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="../static/jquery-media/jquery.media.js"></script>  
		<script type="text/javascript">  
			$(function() {  
				$('.media').media({width:1200, height:650});
				$('.media').css({"margin":"0 auto"});
			});  
		</script> 
	</head>
	<body style="width:97%;margin:0 auto;">
		<div class="layui-tab">
			<ul class="layui-tab-title">
				<li class="layui-this" id="tab1" onclick="$('#tab2').text('电子书添加');">电子书列表</li>
				<li id="tab2" onclick="$('#resetBtn').click();$('#tab2').text('电子书添加');$('#inputForm input[name=id]').val('');">电子书添加</li>
			</ul>
			<div class="layui-tab-content">
				<div class="layui-tab-item layui-show">
					<div class="layui-form" id="searchForm">
						<div class="layui-form-item" style="margin-top: 20px;">
							<div class="layui-inline">
								<label class="layui-form-label">电子书名称</label>
								<div class="layui-input-inline" style="width:220px;">
									<input type="text" name="name" lay-verify="title" autocomplete="off" placeholder="请输入电子书名称" class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">电子书类型</label>
								<div class="layui-input-inline">
									<select name="type" id="type" lay-search="">
										<option value=""></option>
										<optgroup label="计算机类">
											<option value="10001">C</option>
											<option value="10002">Java</option>
											<option value="10003">前端</option>
											<option value="10004">Python</option>
											<option value="10005">数据库</option>
										</optgroup>
										<optgroup label="理学类">
											<option value="10011">数学</option>
											<option value="10012">物理</option>
											<option value="10013">化学</option>
											<option value="10014">天文学</option>
											<option value="10015">地理科学</option>
										</optgroup>
										<optgroup label="语言类">
											<option value="10021">对外汉语</option>
											<option value="10022">六级雅思</option>
											<option value="10023">考研英语</option>
											<option value="10024">听力口语</option>
											<option value="10025">写作翻译</option>
										</optgroup>
									</select>
								</div>
							</div>
							<div class="layui-inline">
								<button type="button" class="layui-btn layui-btn-normal" onclick="search(0)">查询</button>
								<button type="button" class="layui-btn layui-btn-primary" onclick="search(1)">重置</button>
							</div>
						</div>
						<table class="layui-table" id="contentTable">
							<thead>
								<tr>
									<th>序号</th>
									<th>电子书名称</th>
									<th width="250">电子书简介</th>
									<th>电子书类型</th>
									<th>电子书封面</th>
									<th>电子书资源</th>
									<th>上传人</th>
									<th>上传时间</th>
									<th>操作</th>
								</tr> 
							</thead>
							<tbody>
								<tr class="line_1">
									<td>1</td>
									<td>大学物理—量子物理基础及应用</td>
									<td>本课程内容按照对工科生的要求设置。通过学习，学生可以系统地掌握量子物理的基本知识，包括量子物理的实验基础与基本理论，薛定谔方程等。并且能够运用相关概念、理论和方法分析并解决一些相关问题。</td>
									<td>
										<input type="hidden" value="10012"/><label>物理</label>
									</td>
									<td>
										<input type="hidden" value="../static/images/sc_wl.jpg"/>
										<a class="galpop-single" href="../static/images/sc_wl.jpg" title="点击可查看大图">
											<img src="../static/images/sc_wl.jpg" class="img-thumbnail" style="max-width:120px;width:120px;height:70px;"/>
										</a>
									</td>
									<td>
										<a href="javascript:void(0);" onclick="viewPDF()" title="点击可预览pdf">
											<img src="../static/images/pdf_icon.png" width="50" height="50"/>
										</a>
									</td>
									<td>测试用户</td>
									<td>2020-05-21</td>
									<td style="display:none;">无</td>
									<td>
										<button type="button" class="layui-btn layui-btn-primary layui-btn-sm" title="编辑" onclick="update(1)"><i class="layui-icon"></i></button>
										<button type="button" class="layui-btn layui-btn-danger layui-btn-sm" title="删除" onclick="deleteLine(1)"><i class="layui-icon"></i></button>
									</td>
								</tr>
								<tr class="line_2">
									<td>2</td>
									<td>概率论与数理统计</td>
									<td>本课程内容包括：随机事件及其概率、随机变量及其分布、二维随机变量及其分布、随机变量的数字特征、大数定律与中心极限定理、数理统计的基本概念、参数估计、假设检验。</td>
									<td>
										<input type="hidden" value="10011"/><label>数学</label>
									</td>
									<td>
										<input type="hidden" value="../static/images/sc_sx.jpg"/>
										<a class="galpop-single" href="../static/images/sc_sx.jpg" title="点击可查看大图">
											<img src="../static/images/sc_sx.jpg" class="img-thumbnail" style="max-width:120px;width:120px;height:70px;"/>
										</a>
									</td>
									<td>
										<a href="javascript:void(0);" onclick="viewPDF()" title="点击可预览pdf">
											<img src="../static/images/pdf_icon.png" width="50" height="50"/>
										</a>
									</td>
									<td>测试用户</td>
									<td>2020-05-21</td>
									<td style="display:none;">无</td>
									<td>
										<button type="button" class="layui-btn layui-btn-primary layui-btn-sm" title="编辑" onclick="update(2)"><i class="layui-icon"></i></button>"
										<button type="button" class="layui-btn layui-btn-danger layui-btn-sm" title="删除" onclick="deleteLine(2)><i class="layui-icon"></i></button>
									</td>
								</tr>
								<tr class="line_3">
									<td>3</td>
									<td>仪器分析实验</td>
									<td>该课程旨在帮助学习者解释常用分析仪器的测定原理，描述基本构造、应用领域与发展趋势，辨析典型的分析测定方法，并能利用仪器测试评价分析对象，增强对“量”的概念的认识，培养分析解决实际问题的能力。</td>
									<td>
										<input type="hidden" value="10013"/><label>化学</label>
									</td>
									<td>
										<input type="hidden" value="../static/images/sc_hx.jpg"/>
										<a class="galpop-single" href="../static/images/sc_hx.jpg" title="点击可查看大图">
											<img src="../static/images/sc_hx.jpg" class="img-thumbnail" style="max-width:120px;width:120px;height:70px;"/>
										</a>
									</td>
									<td>
										<a href="javascript:void(0);" onclick="viewPDF()" title="点击可预览pdf">
											<img src="../static/images/pdf_icon.png" width="50" height="50"/>
										</a>
									</td>
									<td>测试用户</td>
									<td>2020-05-21</td>
									<td style="display:none;">无</td>
									<td>
										<button type="button" class="layui-btn layui-btn-primary layui-btn-sm" title="编辑" onclick="update(3)"><i class="layui-icon"></i></button>"
										<button type="button" class="layui-btn layui-btn-danger layui-btn-sm" title="删除" onclick="deleteLine(3)><i class="layui-icon"></i></button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div id="page"></div>
				</div>
				<!-- 电子书添加 -->
				<div class="layui-tab-item">
					<div style="width:30%;margin-top:20px;">  
						<form class="layui-form" id="inputForm" lay-filter="example" action="">
						  <input type="hidden" name="id" value=""/>
						  <div class="layui-form-item">
							<label class="layui-form-label"><span style="color:red;">* </span>电子书名称</label>
							<div class="layui-input-block">
							  <input type="text" name="name" required  lay-verify="required" placeholder="请输入名称" autocomplete="off" class="layui-input">
							</div>
						  </div>
						  <div class="layui-form-item">
							<label class="layui-form-label"><span style="color:red;">* </span>电子书简介</label>
							<div class="layui-input-block">
							  <textarea name="intro" placeholder="请输入简介" lay-verify="required" class="layui-textarea"></textarea>
							</div>
						  </div>
						  <div class="layui-form-item">
							<label class="layui-form-label"><span style="color:red;">* </span>电子书分类</label>
							<div class="layui-input-block">
								<select name="type" id="type" lay-verify="required" lay-search="">
									<option value=""></option>
									<optgroup label="计算机类">
										<option value="10001">C</option>
										<option value="10002">Java</option>
										<option value="10003">前端</option>
										<option value="10004">Python</option>
										<option value="10005">数据库</option>
									</optgroup>
									<optgroup label="理学类">
										<option value="10011">数学</option>
										<option value="10012">物理</option>
										<option value="10013">化学</option>
										<option value="10014">天文学</option>
										<option value="10015">地理科学</option>
									</optgroup>
									<optgroup label="语言类">
										<option value="10021">对外汉语</option>
										<option value="10022">六级雅思</option>
										<option value="10023">考研英语</option>
										<option value="10024">听力口语</option>
										<option value="10025">写作翻译</option>
									</optgroup>
								</select>
							</div>
						  </div>
						  <div class="layui-form-item">
							<div class="layui-inline">
							  <label class="layui-form-label"><span style="color:red;">* </span>电子书封面</label>
							  <div class="layui-input-inline" style="width:100px;">
								<div class="layui-upload">
								  <button type="button" class="layui-btn layui-btn-normal" id="uploadBtn">上传图片</button>
								  <div class="layui-upload-list">
									<img class="layui-upload-img" id="uploadImg" style="width:92px;height:92px;display:none;">
									<input type="hidden" id="imgpath" name="imgpath" value=""/>
									<p id="uploadText"></p>
								  </div>
								</div>
							  </div>
							  <div class="layui-form-mid layui-word-aux">图片格式</div>
							</div>
						  </div>
						  <div class="layui-form-item">
							<div class="layui-inline">
							  <label class="layui-form-label"><span style="color:red;">* </span>电子书资源</label>
							  <div class="layui-input-inline" style="width:112px;">
								<a href="javascript:;" class="a-upload">
									<label for="ebook" id="upEBookFile">上传电子书</label>
									<input class="form-control" type="file" style="height:auto;" id="ebook" name="ebook"/>
									<p id="ebookFileName" style="font-weight:bold;"></p>
								</a>
							  </div>
							  <div class="layui-form-mid layui-word-aux">PDF格式</div>
							</div>
						  </div>
						  <div class="layui-form-item layui-form-text">
							<label class="layui-form-label">备注</label>
							<div class="layui-input-block">
							  <textarea name="remark" placeholder="请输入内容" class="layui-textarea"></textarea>
							</div>
						  </div>
						  <div class="layui-form-item">
							<div class="layui-input-block">
							  <button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">保存</button>
							  <button type="reset" class="layui-btn layui-btn-primary" id="resetBtn">重置</button>
							  <button type="button" class="layui-btn layui-btn-primary" onclick="$('#resetBtn,#tab1').click();">返回</button>
							</div>
						  </div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<div id="pdf_main" style="display:none;">
			<div class="panel panel-primary">
			   <div class="panel-body">
			      <a class="media" href="../static/ebooks/pdf1.pdf"></a>  
			   </div>
			</div>
		</div>
		<link type="text/css" rel="stylesheet" href="../static/jquery-galpop/css/jquery.galpop.css" media="screen" />
		<script src="../static/layui-v2.5.6/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../static/jquery-galpop/jquery.galpop.min.js"></script> 
		<script>
		
			$(document).ready(function() {
				$('.galpop-single').galpop();
				$("#resetBtn").click(function(){
					$("#inputForm #uploadImg").hide();
					$("#inputForm #uploadImg").attr("src","");
					$("#inputForm #imgpath").val("");
					$("#inputForm #ebookFileName").html("");
				})
				$("#ebook").on("change",function(){
					//截取路径，获取上传文件名
					var urlArr = this.value.split("\\");
					if (this && this.files && this.files[0]) {
						document.getElementById("ebookFileName").innerHTML = urlArr[urlArr.length-1];
					} else {
						//兼容IE9以下
						document.getElementById("fileName").innerHTML = urlArr[urlArr.length-1];
						document.getElementById("fileImg").style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
						document.getElementById("fileImg").filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = this.value;
					}
				});
			});
			layui.use(['form','element'], function(){
				var $ = layui.jquery
				,element = layui.element;
			});
			layui.use(['laypage', 'layer'], function(){
				var laypage = layui.laypage
				,layer = layui.layer;
				// 总页数低于页码总数
				laypage.render({
					elem: 'page'
					,theme: '#1E9FFF'
					,count: 10 // 数据总数
				});
			});
			layui.use('upload', function(){
			  var $ = layui.jquery
			  ,upload = layui.upload;
			  //普通图片上传
			  var uploadInst = upload.render({
				elem: '#uploadBtn'
				,url: 'https://httpbin.org/post' //改成您自己的上传接口
				,before: function(obj){
				  //预读本地文件示例，不支持ie8
				  obj.preview(function(index, file, result){
					$('#uploadImg').show();
					$('#uploadImg').attr('src', result); //图片链接（base64）
					$('#imgpath').val(result);
				  });
				},done: function(res){
				  //如果上传失败
				  if(res.code > 0){
					return layer.msg('上传失败');
				  }
				},error: function(){
				  //演示失败状态，并实现重传
				  var demoText = $('#uploadText');
				  demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
				  demoText.find('.demo-reload').on('click', function(){
					uploadInst.upload();
				  });
				}
			  });
			 })
			layui.use(['form','element'], function(){
				var form = layui.form;
				// 监听提交
				form.on('submit(formDemo)', function(data){
					// layer.msg(JSON.stringify(data.field));
					var imgpath = $("#inputForm input[name='imgpath']").val();
					var ebookFileName = $("#inputForm #ebookFileName").text().trim();
					if (imgpath == "") {
						layer.msg('请上传电子书封面！', {icon:0});
						return false;
					}
					if (ebookFileName == "") {
						layer.msg('请上传电子书资源！', {icon:0});
						return false;
					} else {
						var suffix = ebookFileName.substring(ebookFileName.length - 4,ebookFileName.length);
						if (suffix != ".pdf") {
							layer.msg('请上传PDF格式文件', {icon:0});
							return false;
						}
					}
					var id = $("#inputForm input[name='id']").val();
					var name = $("#inputForm input[name='name']").val();
					var intro = $("#inputForm textarea[name='intro']").val();
					var typeval = $("#inputForm #type option:selected").val();
					var typetext = $("#inputForm #type option:selected").text();
					var imgpath = $("#inputForm input[name='imgpath']").val();
					// var pdfpath = $("#inputForm input[name='pdfpath']").val();
					var remark = $("#inputForm textarea[name='remark']").val();
					var massage = "";
					if (id != "") {
						// 修改
						$(".line_" + id).children('td').eq(1).text(name);
						$(".line_" + id).children('td').eq(2).text(intro);
						$(".line_" + id).children('td').eq(3).find("input").val(typeval);
						$(".line_" + id).children('td').eq(3).find("label").text(typetext);
						$(".line_" + id).children('td').eq(4).find("input").val(imgpath);
						$(".line_" + id).children('td').eq(4).find("a").attr("href",imgpath);
						$(".line_" + id).children('td').eq(4).find("img").attr("src",imgpath);
						$(".line_" + id).children('td').eq(8).text(remark);
						massage = "修改成功！";
					} else {
						// 新增
						var dataCount = 0;
						$('#contentTable tbody').find('tr').each(function(){
							var id = parseInt($(this).children('td').eq(0).text().trim());
							if (id > dataCount)
								dataCount = id;
						})
						dataCount = dataCount + 1;
						var html = "<tr class='line_"+dataCount+"'>";
						html += "<td>"+dataCount+"</td>";
						html += "<td>"+name+"</td>";
						html += "<td>"+intro+"</td>";
						html += "<td><input type='hidden' value='"+typeval+"'/><label>"+typetext+"</label></td>";
						html += "<td><input type='hidden' value='"+imgpath+"'/>";
						html += "<a class='galpop-single' href='"+imgpath+"' title='点击可查看大图'>";
						html += "<img src='"+imgpath+"' class='img-thumbnail' style='max-width:120px;width:120px;height:70px;'/>";
						html += "</a></td>";
						html += "<td><a href='javascript:void(0);' onclick='viewPDF()' title='点击可预览pdf'>";
						html += "<img src='../static/images/pdf_icon.png' width='50' height='50'/>";
						html += "</a></td>";
						html += "<td>测试用户</td>";
						html += "<td>"+getNowFormatDate()+"</td>";
						html += "<td style='display:none;'>"+remark+"</td>";
						html += "<td>";
						html += "<button type='button' class='layui-btn layui-btn-primary layui-btn-sm' title='编辑' onclick='update("+dataCount+")'><i class='layui-icon'></i></button>";
						html += "<button type='button' class='layui-btn layui-btn-danger layui-btn-sm' title='删除' onclick='deleteLine("+dataCount+")'><i class='layui-icon'></i></button>";
						html += "</td>";
						html += "</tr>";
						$("#contentTable tbody").append(html);
						massage = "添加成功！";
						$('.galpop-single').galpop();
					}
					$("#resetBtn,#tab1").click();
					layer.msg(massage,{icon:1});
					return false;
				});
			});
			// 预览PDF
			function viewPDF() {
				layer.open({
				  type: 1,
				  title: '预览文件',
				  shadeClose: true,
				  shade: 0.5,
				  maxmin: true, //开启最大化最小化按钮
				  area: ['1215px', '700px'],
				  content: $("#pdf_main").html()
				});
			}
			 // 查询 
			 function search(type){
				if (type == 0) {
					$("#contentTable tbody tr").css("display","");
					var nameInput = $("#searchForm input[name='name']").val().trim();
					var typeSelect = $("#searchForm #type option:selected").text().trim();
					for (var i = 0; i < $("#contentTable tbody tr").length; i++) {
						var name = $("#contentTable tbody tr").eq(i).children('td').eq(1).text().trim();
						var type = $("#contentTable tbody tr").eq(i).children('td').eq(3).text().trim();
						if (name.indexOf(nameInput) == -1 || type.indexOf(typeSelect) == -1) {
							$("#contentTable tbody tr").eq(i).css("display","none");
						}
					}
				 } else {
					 $("#contentTable tbody tr").css("display","");
					 $("#searchForm input[name='name']").val("");
					 $('#searchForm #type').siblings("div.layui-form-select").find('dl').find('dd[lay-value=""]').click();
				 }
			}
			// 删除
			function deleteLine(linenum) {
				layer.confirm('您确认要删除该条数据吗？', {
				  btn: ['确认','取消'], title : '系统提示', icon: 3
				}, function(index){
					$(".line_" + linenum).remove();
					layer.close(index);
					layer.msg('删除成功！',{icon:1});
				})
			}
			// 修改
			function update(index) {
				$("#tab2").click();
				$("#tab2").text("电子书修改");
				// 取值
				var id = $(".line_" + index).children('td').eq(0).text().trim();
				var name = $(".line_" + index).children('td').eq(1).text().trim();
				var intro = $(".line_" + index).children('td').eq(2).text().trim();
				var type = $(".line_" + index).children('td').eq(3).find("input").val();
				var imgpath = $(".line_" + index).children('td').eq(4).find("input").val();
				// var videopath = $(".line_" + index).children('td').eq(5).find("input").val();
				var remark = $(".line_" + index).children('td').eq(8).text().trim();
				// 赋值
				$("#inputForm input[name='id']").val(id);
				$("#inputForm input[name='name']").val(name);
				$("#inputForm textarea[name='intro']").val(intro);
				$('#inputForm #type').siblings("div.layui-form-select").find('dl').find('dd[lay-value="'+type+'"]').click();
				$("#inputForm #uploadImg").show();
				$("#inputForm #uploadImg").attr("src",imgpath);
				$("#inputForm #imgpath").val(imgpath);
				//$("#inputForm #video0").show();
				//$("#inputForm #video0").attr("src",videopath);
				//$("#inputForm #videopath").val(videopath);
				$("#inputForm textarea[name='remark']").val(remark);
			}
			
			 // 获取当前日期
			 function getNowFormatDate() {
				var date = new Date();
				var seperator1 = "-";
				var year = date.getFullYear();
				var month = date.getMonth() + 1;
				var strDate = date.getDate();
				if (month >= 1 && month <= 9) {
					month = "0" + month;
				}
				if (strDate >= 0 && strDate <= 9) {
					strDate = "0" + strDate;
				}
				var currentdate = year + seperator1 + month + seperator1 + strDate;
				return currentdate;
			}
		</script>
	</body>
</html>